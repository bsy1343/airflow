<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üöÄ Airflow DAG ÏÉùÏÑ±Í∏∞</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Noto Sans KR', sans-serif;
            background: linear-gradient(135deg, #0f0f23 0%, #1a1a2e 50%, #16213e 100%);
            background-attachment: fixed;
            height: 100vh;
            padding: 3px;
            color: #e4e4e7;
            margin: 0;
            overflow: hidden;
        }
        
        .container {
            width: 100%;
            height: calc(100vh - 6px);
            margin: 0 auto;
            background: rgba(30, 30, 48, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 8px;
            box-shadow: 0 25px 50px rgba(0,0,0,0.3), 0 0 0 1px rgba(255,255,255,0.1);
            overflow: hidden;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
        }
        
        .container:hover {
            box-shadow: 0 30px 60px rgba(0,0,0,0.4), 0 0 0 1px rgba(255,255,255,0.15);
            transform: translateY(-2px);
        }
        
        .header {
            background: linear-gradient(135deg, #4c1d95 0%, #7c3aed 50%, #a855f7 100%);
            color: white;
            padding: 12px 20px;
            text-align: center;
            position: relative;
            overflow: hidden;
            flex-shrink: 0;
        }
        
        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="50" cy="50" r="2" fill="rgba(255,255,255,0.1)"/></svg>') repeat;
            opacity: 0.3;
        }
        
        .header h1 {
            font-size: 1.8em;
            margin-bottom: 4px;
            font-weight: 700;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
            position: relative;
            z-index: 1;
        }
        
        .header p {
            font-size: 0.9em;
            opacity: 0.9;
            position: relative;
            z-index: 1;
        }
        
        .main {
            display: grid;
            grid-template-columns: 380px 1fr;
            flex: 1;
            overflow: hidden;
        }
        
        .sidebar {
            background: linear-gradient(135deg, #1e1e30 0%, #2a2a40 100%);
            padding: 12px;
            border-right: 1px solid rgba(255,255,255,0.1);
            position: relative;
            overflow-y: auto;
        }
        
        .sidebar::after {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            bottom: 0;
            width: 1px;
            background: linear-gradient(to bottom, transparent, rgba(255,255,255,0.2), transparent);
        }
        
        .content {
            padding: 12px;
            overflow-y: auto;
        }
        
        .form-group {
            margin-bottom: 8px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 4px;
            font-weight: 600;
            color: #e4e4e7;
            font-size: 13px;
        }
        
        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 8px 10px;
            border: 2px solid #374151;
            border-radius: 6px;
            font-size: 13px;
            background: rgba(30, 30, 48, 0.8);
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
            color: #e4e4e7;
        }
        
        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #7c3aed;
            box-shadow: 0 4px 16px rgba(124, 58, 237, 0.3);
            transform: translateY(-1px);
        }
        
        .form-group input:hover,
        .form-group select:hover,
        .form-group textarea:hover {
            border-color: #4c1d95;
        }
        
        .form-group textarea {
            resize: vertical;
            min-height: 45px;
        }
        
        .btn {
            background: linear-gradient(135deg, #4c1d95 0%, #7c3aed 50%, #a855f7 100%);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            margin-bottom: 8px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(124, 58, 237, 0.4);
            position: relative;
            overflow: hidden;
        }
        
        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }
        
        .btn:hover::before {
            left: 100%;
        }
        
        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(124, 58, 237, 0.5);
        }
        
        .btn:active {
            transform: translateY(-1px);
        }
        
        .btn:disabled {
            background: linear-gradient(135deg, #ccc, #999);
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .btn:disabled::before {
            display: none;
        }
        
        .preview {
            background: linear-gradient(135deg, #1e1e30 0%, #2a2a40 100%);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 12px;
            padding: 16px;
            margin-top: 16px;
            font-family: 'Monaco', 'Menlo', 'SF Mono', 'Consolas', monospace;
            font-size: 12px;
            line-height: 1.4;
            white-space: pre-wrap;
            height: 1200px;
            overflow-y: auto;
            box-shadow: inset 0 2px 8px rgba(0,0,0,0.3);
            backdrop-filter: blur(10px);
            color: #e4e4e7;
        }
        
        .preview::-webkit-scrollbar {
            width: 8px;
        }
        
        .preview::-webkit-scrollbar-track {
            background: rgba(0,0,0,0.05);
            border-radius: 4px;
        }
        
        .preview::-webkit-scrollbar-thumb {
            background: rgba(124, 58, 237, 0.4);
            border-radius: 4px;
        }
        
        .preview::-webkit-scrollbar-thumb:hover {
            background: rgba(124, 58, 237, 0.6);
        }
        
        .info {
            background: linear-gradient(135deg, #1e1e30 0%, #2a2a40 100%);
            border: 1px solid rgba(124, 58, 237, 0.3);
            border-radius: 8px;
            padding: 10px;
            margin-bottom: 10px;
            box-shadow: 0 4px 12px rgba(124, 58, 237, 0.2);
            backdrop-filter: blur(10px);
        }
        
        .info h3 {
            color: #a855f7;
            margin-bottom: 8px;
            font-weight: 600;
            font-size: 14px;
        }
        
        .info p {
            color: #e4e4e7;
            font-size: 13px;
            line-height: 1.4;
            margin-bottom: 4px;
        }
        
        .info code {
            background: rgba(124, 58, 237, 0.2);
            color: #a855f7;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'Monaco', 'Menlo', 'SF Mono', 'Consolas', monospace;
            font-size: 12px;
        }
        
        .status {
            padding: 12px 16px;
            border-radius: 12px;
            margin-bottom: 20px;
            font-weight: 500;
            transform: translateX(0);
            transition: all 0.3s ease;
            opacity: 0;
            animation: slideIn 0.5s ease forwards;
        }
        
        .status.success {
            background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
            color: #155724;
            border: 1px solid #c3e6cb;
            box-shadow: 0 4px 12px rgba(21, 87, 36, 0.1);
        }
        
        .status.error {
            background: linear-gradient(135deg, #f8d7da 0%, #f5c6cb 100%);
            color: #721c24;
            border: 1px solid #f5c6cb;
            box-shadow: 0 4px 12px rgba(114, 28, 36, 0.1);
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
        
        .form-group {
            animation: fadeInUp 0.6s ease forwards;
            opacity: 0;
        }
        
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .form-group:nth-child(1) { animation-delay: 0.1s; }
        .form-group:nth-child(2) { animation-delay: 0.2s; }
        .form-group:nth-child(3) { animation-delay: 0.3s; }
        .form-group:nth-child(4) { animation-delay: 0.4s; }
        .form-group:nth-child(5) { animation-delay: 0.5s; }
        .form-group:nth-child(6) { animation-delay: 0.6s; }
        
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            
            .container {
                border-radius: 16px;
                margin: 0;
            }
            
            .header {
                padding: 30px 20px;
            }
            
            .header h1 {
                font-size: 2.2em;
            }
            
            .main {
                grid-template-columns: 1fr;
            }
            
            .sidebar {
                border-right: none;
                border-bottom: 1px solid rgba(0,0,0,0.05);
                padding: 20px;
            }
            
            .sidebar::after {
                display: none;
            }
            
            .content {
                padding: 20px;
            }
            
            .form-group {
                margin-bottom: 16px;
            }
            
            .btn {
                padding: 14px 24px;
                font-size: 15px;
            }
        }
        
        @media (max-width: 480px) {
            .header h1 {
                font-size: 1.8em;
            }
            
            .header p {
                font-size: 0.95em;
            }
            
            .sidebar, .content {
                padding: 16px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üöÄ Airflow DAG ÏÉùÏÑ±Í∏∞</h1>
            <p>Î∏åÎùºÏö∞Ï†ÄÏóêÏÑú Î∞îÎ°ú ÏÇ¨Ïö©ÌïòÎäî DAG ÌååÏùº ÏÉùÏÑ±Í∏∞</p>
        </div>
        
        <div class="main">
            <div class="sidebar">
                <h2 style="margin-bottom: 24px; font-size: 1.5em; color: #e4e4e7; font-weight: 600;">‚öôÔ∏è ÏÑ§Ï†ï</h2>
                
                <div class="form-group">
                    <label for="filename">üìÑ ÌååÏùºÎ™Ö</label>
                    <input type="text" id="filename" placeholder="my_dag.py" value="my_dag.py">
                </div>
                
                <div class="form-group">
                    <label for="tags">üè∑Ô∏è ÌÉúÍ∑∏ (ÏΩ§ÎßàÎ°ú Íµ¨Î∂Ñ)</label>
                    <input type="text" id="tags" placeholder="tag1, tag2, tag3" value="auto-generated">
                </div>
                
                <div class="form-group">
                    <label for="description">üìù ÏÑ§Î™Ö</label>
                    <textarea id="description" placeholder="DAGÏóê ÎåÄÌïú ÏÉÅÏÑ∏Ìïú ÏÑ§Î™ÖÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî">ÏûêÎèô ÏÉùÏÑ±Îêú DAG</textarea>
                </div>
                
                <div class="form-group">
                    <label for="owner">üë§ ÏÜåÏú†Ïûê</label>
                    <input type="text" id="owner" placeholder="ÌôçÍ∏∏Îèô" value="ÌôçÍ∏∏Îèô">
                </div>
                
                <div class="form-group">
                    <label for="email">üìß Ïù¥Î©îÏùº</label>
                    <input type="email" id="email" placeholder="admin@kt.com" value="admin@kt.com">
                </div>
                
                <div class="form-group">
                    <label for="schedule_type">‚è∞ Ïä§ÏºÄÏ§Ñ ÌÉÄÏûÖ</label>
                    <select id="schedule_type" onchange="toggleScheduleInput()">
                        <option value="preset">ÎØ∏Î¶¨ ÏÑ§Ï†ïÎêú Ïä§ÏºÄÏ§Ñ</option>
                        <option value="cron">Cron ÌëúÌòÑÏãù</option>
                        <option value="timedelta">ÏãúÍ∞Ñ Í∞ÑÍ≤©</option>
                        <option value="none">None (ÏàòÎèô Ïã§Ìñâ)</option>
                    </select>
                </div>
                
                <div class="form-group" id="preset-schedule">
                    <label for="schedule_preset">‚è∞ Ïä§ÏºÄÏ§Ñ</label>
                    <select id="schedule_preset">
                        <option value="@daily">@daily (Îß§Ïùº)</option>
                        <option value="@hourly">@hourly (Îß§ÏãúÍ∞Ñ)</option>
                        <option value="@weekly">@weekly (Îß§Ï£º)</option>
                        <option value="@monthly">@monthly (Îß§Ïõî)</option>
                    </select>
                </div>
                
                <div class="form-group" id="cron-schedule" style="display: none;">
                    <label for="schedule_cron">‚è∞ Cron ÌëúÌòÑÏãù</label>
                    <input type="text" id="schedule_cron" placeholder="*/5 * * * *" value="*/5 * * * *" oninput="updateCronDescription()">
                    <small id="cron-description" style="color: #9ca3af; font-size: 12px; display: block; margin-top: 4px;">5Î∂ÑÎßàÎã§ Ïã§Ìñâ</small>
                </div>
                
                <div class="form-group" id="timedelta-schedule" style="display: none;">
                    <label for="schedule_timedelta">‚è∞ Ïã§Ìñâ Í∞ÑÍ≤© (Î∂Ñ)</label>
                    <input type="number" id="schedule_timedelta" placeholder="60" value="60" min="1">
                </div>
                
                <div class="form-group">
                    <label for="start_date">üìÖ ÏãúÏûëÏùº</label>
                    <input type="date" id="start_date">
                </div>
                
                <div class="form-group">
                    <label for="end_date">üîö Ï¢ÖÎ£åÏùº (ÏÑ†ÌÉùÏÇ¨Ìï≠)</label>
                    <input type="date" id="end_date">
                </div>
                
                <div class="form-group">
                    <label for="retries">üîÑ Ïû¨ÏãúÎèÑ ÌöüÏàò</label>
                    <input type="number" id="retries" placeholder="1" value="1" min="0" max="10">
                </div>
                
                <div class="form-group">
                    <label for="retry_delay">‚è≥ Ïû¨ÏãúÎèÑ ÏßÄÏó∞ ÏãúÍ∞Ñ (Î∂Ñ)</label>
                    <input type="number" id="retry_delay" placeholder="5" value="5" min="1">
                </div>
                
                <div class="form-group">
                    <label for="max_active_runs">üî¢ ÏµúÎåÄ ÎèôÏãú Ïã§Ìñâ Ïàò</label>
                    <input type="number" id="max_active_runs" placeholder="1" value="1" min="1">
                </div>
                
                
                <button class="btn" onclick="generateDAG()">üîÑ DAG ÏÉùÏÑ±</button>
                <button class="btn" onclick="downloadFile()" id="downloadBtn" disabled>üíæ ÌååÏùº Îã§Ïö¥Î°úÎìú</button>
                
                <div class="info">
                    <h3>üí° ÏÇ¨Ïö©Î≤ï</h3>
                    <p>1. ÌååÏùºÎ™Ö ÏûÖÎ†• (DAG ID ÏûêÎèô ÏÉùÏÑ±)</p>
                    <p>2. ÏÜåÏú†Ïûê Î∞è Ïù¥Î©îÏùº Ï†ïÎ≥¥ ÏûÖÎ†•</p>
                    <p>3. Ïä§ÏºÄÏ§Ñ ÌÉÄÏûÖ ÏÑ†ÌÉù Î∞è ÏÑ§Ï†ï</p>
                    <p>4. Ïû¨ÏãúÎèÑ ÏòµÏÖò Î∞è ÌÉúÍ∑∏ ÏÑ§Ï†ï</p>
                    <p>5. DAG ÏÉùÏÑ± ‚Üí ÎØ∏Î¶¨Î≥¥Í∏∞ ÌôïÏù∏ ‚Üí Îã§Ïö¥Î°úÎìú</p>
                </div>
                
                <div class="info">
                    <h3>üîß ÏÉùÏÑ±ÎêòÎäî ÌÖúÌîåÎ¶ø (ÏòàÏãú)</h3>
                    <p>‚Ä¢ <strong>Task 1:</strong> ÏÑúÎ≤Ñ ÏÉÅÌÉú ÌôïÏù∏</p>
                    <p>‚Ä¢ <strong>Task 2:</strong> ÏãúÏä§ÌÖú Ï†ïÎ≥¥ ÌôïÏù∏</p>
                    <p>‚Ä¢ <strong>ÏùòÏ°¥ÏÑ±:</strong> Task 1 ‚Üí Task 2</p>
                </div>
                
                <div class="info">
                    <h3>‚ö†Ô∏è ÏÇ¨Ïö© Ï†Ñ ÌïÑÏàò ÏÑ§Ï†ï (ÏòàÏãú)</h3>
                    <p>‚Ä¢ Airflow Connection ÏÑ§Ï†ï:</p>
                    <p>  - Connection ID: <code>ssh_default</code></p>
                    <p>  - SSH Ìò∏Ïä§Ìä∏, ÏÇ¨Ïö©Ïûê, ÌÇ§ ÌååÏùº ÏÑ§Ï†ï</p>
                </div>
            </div>
            
            <div class="content">
                <h2 style="margin-bottom: 24px; font-size: 1.5em; color: #e4e4e7; font-weight: 600;">üìù DAG Ï†ïÎ≥¥ Î∞è ÎØ∏Î¶¨Î≥¥Í∏∞</h2>
                
                <div id="status"></div>
                
                <div id="preview" class="preview" style="display: none;"></div>
                
                <div id="info-panel">
                    <p>ÏÑ§Ï†ïÏùÑ ÏûÖÎ†•ÌïòÍ≥† "DAG ÏÉùÏÑ±" Î≤ÑÌäºÏùÑ ÌÅ¥Î¶≠ÌïòÏÑ∏Ïöî.</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        const DAG_TEMPLATE = `
# =============================================================================
# DAG ÌååÏùºÎ™Ö: {dag_id}
# ÏûëÏÑ±Ïûê: {owner}
# Ïù¥Î©îÏùº: {email}
# ÏÉùÏÑ±Ïùº: {generated_date}
#
# DAG ÏÑ§Î™Ö:
# {description}
#
# Ïã§Ìñâ Ïä§ÏºÄÏ§Ñ: {schedule}
# Ïû¨ÏãúÎèÑ ÌöüÏàò: {retries}Ìöå
# Ïû¨ÏãúÎèÑ Í∞ÑÍ≤©: {retry_delay}Î∂Ñ
# ÏµúÎåÄ ÎèôÏãú Ïã§Ìñâ: {max_active_runs}Í∞ú
# =============================================================================

from airflow import DAG
from airflow.providers.ssh.operators.ssh import SSHOperator
from datetime import datetime, timedelta

# ==============================================================================
# DAG Í∏∞Î≥∏ ÏÑ§Ï†ï
# ==============================================================================

# Í∏∞Î≥∏ Ïù∏Ïûê ÏÑ§Ï†ï - Î™®Îì† ÌÉúÏä§ÌÅ¨Ïóê Í≥µÌÜµÏúºÎ°ú Ï†ÅÏö©
default_args = {
    'owner': '{owner}',
    'depends_on_past': False,
    'email': ['{email}'],
    'email_on_failure': True,
    'email_on_retry': False,
    'retries': {retries},
    'retry_delay': timedelta(minutes={retry_delay}),
    'start_date': datetime({start_year}, {start_month}, {start_day}),
}

# ==============================================================================
# DAG Ï†ïÏùò
# ==============================================================================

# DAG Ïù∏Ïä§ÌÑ¥Ïä§ ÏÉùÏÑ±
dag = DAG(
    dag_id='{dag_id}',
    description='{description}',
    default_args=default_args,
    schedule_interval={schedule},
    start_date=datetime({start_year}, {start_month}, {start_day}),{end_date_line}
    catchup=False,
    max_active_runs={max_active_runs},
    tags={tags},
    doc_md=__doc__,
)

# ==============================================================================
# ÌÉúÏä§ÌÅ¨ Ï†ïÏùò
# ==============================================================================

# ÌÉúÏä§ÌÅ¨ 1: ÏÑúÎ≤Ñ ÏÉÅÌÉú ÌôïÏù∏
check_host = SSHOperator(
    task_id='check_host',
    ssh_conn_id='ssh_default',
    command='echo "Hello from localhost: $(hostname) at $(date)"',
    dag=dag,
)

# ÌÉúÏä§ÌÅ¨ 2: ÏãúÏä§ÌÖú Ï†ïÎ≥¥ ÌôïÏù∏
system_info = HttpOperator(
    task_id='system_info',
	method='POST',
	http_conn_id='http_default',
	headers={'Content-Type': 'application/json'},
    endpoint='http://localhost:5000/system_info',
	data=json.dumps({
        "action": "get_info"
    }),
    dag=dag,
)

# ==============================================================================
# ÌÉúÏä§ÌÅ¨ ÏùòÏ°¥ÏÑ± Ï†ïÏùò
# ==============================================================================

# ÌÉúÏä§ÌÅ¨ Ïã§Ìñâ ÏàúÏÑú Ï†ïÏùò
check_host >> system_info
`;

        let generatedCode = '';
        let generatedFilename = '';

        function toggleScheduleInput() {
            const scheduleType = document.getElementById('schedule_type').value;
            const presetDiv = document.getElementById('preset-schedule');
            const cronDiv = document.getElementById('cron-schedule');
            const timeDeltaDiv = document.getElementById('timedelta-schedule');
            
            // Î™®Îì† Ïä§ÏºÄÏ§Ñ ÏûÖÎ†• Ïà®Í∏∞Í∏∞
            presetDiv.style.display = 'none';
            cronDiv.style.display = 'none';
            timeDeltaDiv.style.display = 'none';
            
            // ÏÑ†ÌÉùÎêú ÌÉÄÏûÖÏóê Îî∞Îùº ÌëúÏãú
            switch(scheduleType) {
                case 'preset':
                    presetDiv.style.display = 'block';
                    break;
                case 'cron':
                    cronDiv.style.display = 'block';
                    break;
                case 'timedelta':
                    timeDeltaDiv.style.display = 'block';
                    break;
            }
        }

        function generateDAG() {
            // Ìèº Îç∞Ïù¥ÌÑ∞ ÏàòÏßë
            const filename = document.getElementById('filename').value.trim();
            const owner = document.getElementById('owner').value.trim();
            const email = document.getElementById('email').value.trim();
            const description = document.getElementById('description').value.trim();
            const scheduleType = document.getElementById('schedule_type').value;
            const retries = document.getElementById('retries').value;
            const retryDelay = document.getElementById('retry_delay').value;
            const tags = document.getElementById('tags').value.trim();
            const maxActiveRuns = document.getElementById('max_active_runs').value;
            const startDate = document.getElementById('start_date').value;
            const endDate = document.getElementById('end_date').value;
            
            // Ïú†Ìö®ÏÑ± Í≤ÄÏÇ¨
            if (!filename) {
                showStatus('error', 'ÌååÏùºÎ™ÖÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.');
                return;
            }
            
            if (!filename.endsWith('.py')) {
                showStatus('error', 'ÌååÏùºÎ™ÖÏùÄ .py ÌôïÏû•ÏûêÎ°ú ÎÅùÎÇòÏïº Ìï©ÎãàÎã§.');
                return;
            }
            
            if (!owner) {
                showStatus('error', 'ÏÜåÏú†ÏûêÎ•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.');
                return;
            }
            
            if (!email) {
                showStatus('error', 'Ïù¥Î©îÏùºÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.');
                return;
            }
            
            // DAG ID ÏÉùÏÑ± (ÌååÏùºÎ™ÖÏóêÏÑú .py Ï†úÍ±∞)
            const dagId = filename.replace('.py', '');
            
            // Ïä§ÏºÄÏ§Ñ Ï≤òÎ¶¨
            let schedule;
            switch(scheduleType) {
                case 'preset':
                    schedule = `'${document.getElementById('schedule_preset').value}'`;
                    break;
                case 'cron':
                    const cronValue = document.getElementById('schedule_cron').value.trim();
                    if (!cronValue) {
                        showStatus('error', 'Cron ÌëúÌòÑÏãùÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.');
                        return;
                    }
                    schedule = `'${cronValue}'`;
                    break;
                case 'timedelta':
                    const minutes = document.getElementById('schedule_timedelta').value;
                    if (!minutes) {
                        showStatus('error', 'Ïã§Ìñâ Í∞ÑÍ≤©ÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.');
                        return;
                    }
                    schedule = `timedelta(minutes=${minutes})`;
                    break;
                case 'none':
                    schedule = 'None';
                    break;
            }
            
            // ÌÉúÍ∑∏ Ï≤òÎ¶¨
            const tagsList = tags.split(',').map(tag => tag.trim()).filter(tag => tag);
            const tagsFormatted = JSON.stringify(tagsList);
            
            // ÎÇ†Ïßú Ï≤òÎ¶¨
            const startDateObj = new Date(startDate);
            const startYear = startDateObj.getFullYear();
            const startMonth = startDateObj.getMonth() + 1;
            const startDay = startDateObj.getDate();
            
            let endDateLine = '';
            if (endDate) {
                const endDateObj = new Date(endDate);
                const endYear = endDateObj.getFullYear();
                const endMonth = endDateObj.getMonth() + 1;
                const endDay = endDateObj.getDate();
                endDateLine = `\n    end_date=datetime(${endYear}, ${endMonth}, ${endDay}),`;
            }
            
            // ÌòÑÏû¨ ÎÇ†Ïßú
            const now = new Date();
            const generatedDate = now.toISOString().split('T')[0];
            
            // ÏΩîÎìú ÏÉùÏÑ±
            generatedCode = DAG_TEMPLATE
                .replace(/{dag_id}/g, dagId)
                .replace(/{description}/g, description)
                .replace(/{owner}/g, owner)
                .replace(/{email}/g, email)
                .replace(/{generated_date}/g, generatedDate)
                .replace(/{schedule}/g, schedule)
                .replace(/{retries}/g, retries)
                .replace(/{retry_delay}/g, retryDelay)
                .replace(/{max_active_runs}/g, maxActiveRuns)
                .replace(/{tags}/g, tagsFormatted)
                .replace(/{start_year}/g, startYear)
                .replace(/{start_month}/g, startMonth)
                .replace(/{start_day}/g, startDay)
                .replace(/{end_date_line}/g, endDateLine);
            
            generatedFilename = filename;
            
            // UI ÏóÖÎç∞Ïù¥Ìä∏ - DAG ÏÉùÏÑ± ÌõÑÏóêÎäî ÎØ∏Î¶¨Î≥¥Í∏∞Îßå ÌëúÏãú
            document.getElementById('preview').textContent = generatedCode;
            document.getElementById('preview').style.display = 'block';
            document.getElementById('downloadBtn').disabled = false;
            
            // Ï†ïÎ≥¥ Ìå®ÎÑê Ïà®Í∏∞Í∏∞
            document.getElementById('info-panel').style.display = 'none';
            
            showStatus('success', 'üéâ DAG ÌååÏùºÏù¥ ÏÑ±Í≥µÏ†ÅÏúºÎ°ú ÏÉùÏÑ±ÎêòÏóàÏäµÎãàÎã§!');
        }
        
        // Í∞ÑÎã®Ìïú Python Íµ¨Î¨∏ Í∞ïÏ°∞ Ìï®Ïàò
        function highlightPython(code) {
            return code
                .replace(/^(#.*$)/gm, '<span style="color: #6a9955; font-style: italic;">$1</span>')
                .replace(/\b(from|import|def|class|if|else|elif|for|while|try|except|finally|with|as|return|yield|break|continue|pass|raise|lambda|and|or|not|in|is|True|False|None)\b/g, '<span style="color: #569cd6;">$1</span>')
                .replace(/\b(DAG|SSHOperator|BashOperator|PythonOperator|datetime|timedelta)\b/g, '<span style="color: #4ec9b0;">$1</span>')
                .replace(/(['"])(.*?)\1/g, '<span style="color: #ce9178;">$1$2$1</span>')
                .replace(/\b(\d+)\b/g, '<span style="color: #b5cea8;">$1</span>');
        }
        
        function downloadFile() {
            if (!generatedCode) {
                showStatus('error', 'Î®ºÏ†Ä DAGÎ•º ÏÉùÏÑ±Ìï¥Ï£ºÏÑ∏Ïöî.');
                return;
            }
            
            const blob = new Blob([generatedCode], {type: 'text/plain;charset=utf-8'});
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = generatedFilename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
            
            showStatus('success', `üíæ ${generatedFilename} ÌååÏùºÏù¥ Îã§Ïö¥Î°úÎìúÎêòÏóàÏäµÎãàÎã§!`);
        }
        
        function showStatus(type, message) {
            const statusDiv = document.getElementById('status');
            statusDiv.className = `status ${type}`;
            statusDiv.textContent = message;
            
            // 3Ï¥à ÌõÑ ÏÉÅÌÉú Î©îÏãúÏßÄ Ï†úÍ±∞
            setTimeout(() => {
                statusDiv.textContent = '';
                statusDiv.className = '';
            }, 3000);
        }
        
        // Ïã§ÏãúÍ∞Ñ ÎØ∏Î¶¨Î≥¥Í∏∞ (ÏòµÏÖò)
        document.getElementById('filename').addEventListener('input', updateInfo);
        document.getElementById('owner').addEventListener('input', updateInfo);
        document.getElementById('email').addEventListener('input', updateInfo);
        document.getElementById('description').addEventListener('input', updateInfo);
        
        function updateInfo() {
            const filename = document.getElementById('filename').value.trim();
            const owner = document.getElementById('owner').value.trim();
            const email = document.getElementById('email').value.trim();
            const dagId = filename.replace('.py', '');
            
            if (filename || owner || email) {
                document.getElementById('info-panel').innerHTML = `
                    <div class="info">
                        <h3>üìã ÌòÑÏû¨ ÏÑ§Ï†ï</h3>
                        <p><strong>ÌååÏùºÎ™Ö:</strong> ${filename || 'ÎØ∏ÏûÖÎ†•'}</p>
                        <p><strong>DAG ID:</strong> ${dagId || 'ÎØ∏ÏûÖÎ†•'}</p>
                        <p><strong>ÏÜåÏú†Ïûê:</strong> ${owner || 'ÎØ∏ÏûÖÎ†•'}</p>
                        <p><strong>Ïù¥Î©îÏùº:</strong> ${email || 'ÎØ∏ÏûÖÎ†•'}</p>
                    </div>
                `;
            } else {
                document.getElementById('info-panel').innerHTML = `
                    <div class="info">
                        <h3>üìã ÌòÑÏû¨ ÏÑ§Ï†ï</h3>
                        <p>ÏÑ§Ï†ïÏùÑ ÏûÖÎ†•ÌïòÍ≥† "DAG ÏÉùÏÑ±" Î≤ÑÌäºÏùÑ ÌÅ¥Î¶≠ÌïòÏÑ∏Ïöî.</p>
                    </div>
                `;
            }
        }
        
        // Cron ÌëúÌòÑÏãù ÏÑ§Î™Ö ÏóÖÎç∞Ïù¥Ìä∏ Ìï®Ïàò
        function updateCronDescription() {
            const cronValue = document.getElementById('schedule_cron').value.trim();
            const cronDescription = document.getElementById('cron-description');
            
            if (!cronValue) {
                cronDescription.textContent = 'Cron ÌëúÌòÑÏãùÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî';
                return;
            }
            
            const parts = cronValue.split(' ');
            if (parts.length !== 5) {
                cronDescription.textContent = 'Ïò¨Î∞îÎ•∏ Cron ÌòïÏãù: Î∂Ñ Ïãú Ïùº Ïõî ÏöîÏùº (5Í∞ú ÌïÑÎìú)';
                return;
            }
            
            const [minute, hour, day, month, dayOfWeek] = parts;
            
            // ÏùºÎ∞òÏ†ÅÏù∏ Cron Ìå®ÌÑ¥ Ìï¥ÏÑù
            const descriptions = {
                '0 0 * * *': 'Îß§Ïùº ÏûêÏ†ï (00:00)Ïóê Ïã§Ìñâ',
                '0 6 * * *': 'Îß§Ïùº Ïò§Ï†Ñ 6ÏãúÏóê Ïã§Ìñâ',
                '0 12 * * *': 'Îß§Ïùº Ï†ïÏò§ (12:00)Ïóê Ïã§Ìñâ',
                '0 18 * * *': 'Îß§Ïùº Ïò§ÌõÑ 6ÏãúÏóê Ïã§Ìñâ',
                '0 0 * * 0': 'Îß§Ï£º ÏùºÏöîÏùº ÏûêÏ†ïÏóê Ïã§Ìñâ',
                '0 0 * * 1': 'Îß§Ï£º ÏõîÏöîÏùº ÏûêÏ†ïÏóê Ïã§Ìñâ',
                '0 0 1 * *': 'Îß§Ïõî 1Ïùº ÏûêÏ†ïÏóê Ïã§Ìñâ',
                '0 0 1 1 *': 'Îß§ÎÖÑ 1Ïõî 1Ïùº ÏûêÏ†ïÏóê Ïã§Ìñâ',
                '*/5 * * * *': '5Î∂ÑÎßàÎã§ Ïã§Ìñâ',
                '*/10 * * * *': '10Î∂ÑÎßàÎã§ Ïã§Ìñâ',
                '*/15 * * * *': '15Î∂ÑÎßàÎã§ Ïã§Ìñâ',
                '*/30 * * * *': '30Î∂ÑÎßàÎã§ Ïã§Ìñâ',
                '0 */2 * * *': '2ÏãúÍ∞ÑÎßàÎã§ Ïã§Ìñâ',
                '0 */4 * * *': '4ÏãúÍ∞ÑÎßàÎã§ Ïã§Ìñâ',
                '0 */6 * * *': '6ÏãúÍ∞ÑÎßàÎã§ Ïã§Ìñâ',
                '0 */12 * * *': '12ÏãúÍ∞ÑÎßàÎã§ Ïã§Ìñâ',
                '0 9 * * 1-5': 'ÌèâÏùº Ïò§Ï†Ñ 9ÏãúÏóê Ïã§Ìñâ',
                '0 17 * * 1-5': 'ÌèâÏùº Ïò§ÌõÑ 5ÏãúÏóê Ïã§Ìñâ',
                '0 0 * * 6,7': 'Ï£ºÎßê ÏûêÏ†ïÏóê Ïã§Ìñâ',
                '0 0 15 * *': 'Îß§Ïõî 15Ïùº ÏûêÏ†ïÏóê Ïã§Ìñâ',
                '0 9-17 * * 1-5': 'ÌèâÏùº Ïò§Ï†Ñ 9ÏãúÎ∂ÄÌÑ∞ Ïò§ÌõÑ 5ÏãúÍπåÏßÄ Îß§ÏãúÍ∞Ñ Ïã§Ìñâ'
            };
            
            if (descriptions[cronValue]) {
                cronDescription.textContent = descriptions[cronValue];
                return;
            }
            
            // Í∏∞Î≥∏ Ìï¥ÏÑù Î°úÏßÅ
            let desc = '';
            
            // Î∂Ñ Ìï¥ÏÑù
            if (minute === '*') {
                desc += 'Îß§Î∂Ñ ';
            } else if (minute.includes('*/')) {
                const interval = minute.split('*/')[1];
                desc += `${interval}Î∂ÑÎßàÎã§ `;
            } else {
                desc += `${minute}Î∂ÑÏóê `;
            }
            
            // ÏãúÍ∞Ñ Ìï¥ÏÑù
            if (hour === '*') {
                desc += 'Îß§ÏãúÍ∞Ñ ';
            } else if (hour.includes('*/')) {
                const interval = hour.split('*/')[1];
                desc += `${interval}ÏãúÍ∞ÑÎßàÎã§ `;
            } else {
                desc += `${hour}ÏãúÏóê `;
            }
            
            // Ïùº Ìï¥ÏÑù
            if (day === '*') {
                desc += 'Îß§Ïùº ';
            } else if (day.includes('*/')) {
                const interval = day.split('*/')[1];
                desc += `${interval}ÏùºÎßàÎã§ `;
            } else {
                desc += `${day}ÏùºÏóê `;
            }
            
            // Ïõî Ìï¥ÏÑù
            if (month === '*') {
                desc += 'Îß§Ïõî ';
            } else {
                const months = ['', '1Ïõî', '2Ïõî', '3Ïõî', '4Ïõî', '5Ïõî', '6Ïõî', '7Ïõî', '8Ïõî', '9Ïõî', '10Ïõî', '11Ïõî', '12Ïõî'];
                desc += `${months[parseInt(month)]}Ïóê `;
            }
            
            // ÏöîÏùº Ìï¥ÏÑù
            if (dayOfWeek !== '*') {
                const days = ['Ïùº', 'Ïõî', 'Ìôî', 'Ïàò', 'Î™©', 'Í∏à', 'ÌÜ†'];
                if (dayOfWeek === '1-5') {
                    desc += '(ÌèâÏùº) ';
                } else if (dayOfWeek === '6,7' || dayOfWeek === '0,6') {
                    desc += '(Ï£ºÎßê) ';
                } else if (dayOfWeek.includes(',')) {
                    const dayNumbers = dayOfWeek.split(',');
                    const dayNames = dayNumbers.map(d => days[parseInt(d)]);
                    desc += `(${dayNames.join(', ')}) `;
                } else {
                    desc += `(${days[parseInt(dayOfWeek)]}) `;
                }
            }
            
            cronDescription.textContent = desc.trim() + 'Ïóê Ïã§Ìñâ';
        }
        
        // ÌéòÏù¥ÏßÄ Î°úÎìú Ïãú Ï¥àÍ∏∞ ÏÑ§Ï†ï
        function initializePage() {
            // ÏãúÏûëÏùºÏùÑ Ïò§Îäò ÎÇ†ÏßúÎ°ú ÏÑ§Ï†ï
            const today = new Date();
            const todayString = today.toISOString().split('T')[0];
            document.getElementById('start_date').value = todayString;
            
            // Ï¥àÍ∏∞ Ï†ïÎ≥¥ ÏóÖÎç∞Ïù¥Ìä∏
            updateInfo();
        }
        
        // ÌéòÏù¥ÏßÄ Î°úÎìú Ïãú Ï¥àÍ∏∞Ìôî
        initializePage();
    </script>
</body>
</html>