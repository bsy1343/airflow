<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸš€ Airflow DAG ìƒì„±ê¸°</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Noto Sans KR', sans-serif;
            background: linear-gradient(135deg, #0f0f23 0%, #1a1a2e 50%, #16213e 100%);
            background-attachment: fixed;
            height: 100vh;
            padding: 3px;
            color: #e4e4e7;
            margin: 0;
            overflow: hidden;
        }
        
        .container {
            width: 100%;
            height: calc(100vh - 6px);
            margin: 0 auto;
            background: rgba(30, 30, 48, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 8px;
            box-shadow: 0 25px 50px rgba(0,0,0,0.3), 0 0 0 1px rgba(255,255,255,0.1);
            overflow: hidden;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
        }
        
        .container:hover {
            box-shadow: 0 30px 60px rgba(0,0,0,0.4), 0 0 0 1px rgba(255,255,255,0.15);
            transform: translateY(-2px);
        }
        
        .header {
            background: linear-gradient(135deg, #4c1d95 0%, #7c3aed 50%, #a855f7 100%);
            color: white;
            padding: 12px 20px;
            text-align: center;
            position: relative;
            overflow: hidden;
            flex-shrink: 0;
        }
        
        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="50" cy="50" r="2" fill="rgba(255,255,255,0.1)"/></svg>') repeat;
            opacity: 0.3;
        }
        
        .header h1 {
            font-size: 1.8em;
            margin-bottom: 4px;
            font-weight: 700;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
            position: relative;
            z-index: 1;
        }
        
        .header p {
            font-size: 0.9em;
            opacity: 0.9;
            position: relative;
            z-index: 1;
        }
        
        .main {
            display: grid;
            grid-template-columns: 380px 1fr;
            flex: 1;
            overflow: hidden;
        }
        
        .sidebar {
            background: linear-gradient(135deg, #1e1e30 0%, #2a2a40 100%);
            padding: 12px;
            border-right: 1px solid rgba(255,255,255,0.1);
            position: relative;
            overflow-y: auto;
        }
        
        .sidebar::after {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            bottom: 0;
            width: 1px;
            background: linear-gradient(to bottom, transparent, rgba(255,255,255,0.2), transparent);
        }
        
        .content {
            padding: 12px;
            overflow-y: auto;
        }
        
        .form-group {
            margin-bottom: 8px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 4px;
            font-weight: 600;
            color: #e4e4e7;
            font-size: 13px;
        }
        
        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 8px 10px;
            border: 2px solid #374151;
            border-radius: 6px;
            font-size: 13px;
            background: rgba(30, 30, 48, 0.8);
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
            color: #e4e4e7;
        }
        
        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #7c3aed;
            box-shadow: 0 4px 16px rgba(124, 58, 237, 0.3);
            transform: translateY(-1px);
        }
        
        .form-group input:hover,
        .form-group select:hover,
        .form-group textarea:hover {
            border-color: #4c1d95;
        }
        
        .form-group textarea {
            resize: vertical;
            min-height: 45px;
        }
        
        .btn {
            background: linear-gradient(135deg, #4c1d95 0%, #7c3aed 50%, #a855f7 100%);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            margin-bottom: 8px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(124, 58, 237, 0.4);
            position: relative;
            overflow: hidden;
        }
        
        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }
        
        .btn:hover::before {
            left: 100%;
        }
        
        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(124, 58, 237, 0.5);
        }
        
        .btn:active {
            transform: translateY(-1px);
        }
        
        .btn:disabled {
            background: linear-gradient(135deg, #ccc, #999);
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .btn:disabled::before {
            display: none;
        }
        
        .preview {
            background: linear-gradient(135deg, #1e1e30 0%, #2a2a40 100%);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 12px;
            padding: 16px;
            margin-top: 16px;
            font-family: 'Monaco', 'Menlo', 'SF Mono', 'Consolas', monospace;
            font-size: 12px;
            line-height: 1.4;
            white-space: pre-wrap;
            height: 1200px;
            overflow-y: auto;
            box-shadow: inset 0 2px 8px rgba(0,0,0,0.3);
            backdrop-filter: blur(10px);
            color: #e4e4e7;
        }
        
        .preview::-webkit-scrollbar {
            width: 8px;
        }
        
        .preview::-webkit-scrollbar-track {
            background: rgba(0,0,0,0.05);
            border-radius: 4px;
        }
        
        .preview::-webkit-scrollbar-thumb {
            background: rgba(124, 58, 237, 0.4);
            border-radius: 4px;
        }
        
        .preview::-webkit-scrollbar-thumb:hover {
            background: rgba(124, 58, 237, 0.6);
        }
        
        .info {
            background: linear-gradient(135deg, #1e1e30 0%, #2a2a40 100%);
            border: 1px solid rgba(124, 58, 237, 0.3);
            border-radius: 8px;
            padding: 10px;
            margin-bottom: 10px;
            box-shadow: 0 4px 12px rgba(124, 58, 237, 0.2);
            backdrop-filter: blur(10px);
        }
        
        .info h3 {
            color: #a855f7;
            margin-bottom: 8px;
            font-weight: 600;
            font-size: 14px;
        }
        
        .info p {
            color: #e4e4e7;
            font-size: 13px;
            line-height: 1.4;
            margin-bottom: 4px;
        }
        
        .info code {
            background: rgba(124, 58, 237, 0.2);
            color: #a855f7;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'Monaco', 'Menlo', 'SF Mono', 'Consolas', monospace;
            font-size: 12px;
        }
        
        .status {
            padding: 12px 16px;
            border-radius: 12px;
            margin-bottom: 20px;
            font-weight: 500;
            transform: translateX(0);
            transition: all 0.3s ease;
            opacity: 0;
            animation: slideIn 0.5s ease forwards;
        }
        
        .status.success {
            background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
            color: #155724;
            border: 1px solid #c3e6cb;
            box-shadow: 0 4px 12px rgba(21, 87, 36, 0.1);
        }
        
        .status.error {
            background: linear-gradient(135deg, #f8d7da 0%, #f5c6cb 100%);
            color: #721c24;
            border: 1px solid #f5c6cb;
            box-shadow: 0 4px 12px rgba(114, 28, 36, 0.1);
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
        
        .form-group {
            animation: fadeInUp 0.6s ease forwards;
            opacity: 0;
        }
        
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .form-group:nth-child(1) { animation-delay: 0.1s; }
        .form-group:nth-child(2) { animation-delay: 0.2s; }
        .form-group:nth-child(3) { animation-delay: 0.3s; }
        .form-group:nth-child(4) { animation-delay: 0.4s; }
        .form-group:nth-child(5) { animation-delay: 0.5s; }
        .form-group:nth-child(6) { animation-delay: 0.6s; }
        
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            
            .container {
                border-radius: 16px;
                margin: 0;
            }
            
            .header {
                padding: 30px 20px;
            }
            
            .header h1 {
                font-size: 2.2em;
            }
            
            .main {
                grid-template-columns: 1fr;
            }
            
            .sidebar {
                border-right: none;
                border-bottom: 1px solid rgba(0,0,0,0.05);
                padding: 20px;
            }
            
            .sidebar::after {
                display: none;
            }
            
            .content {
                padding: 20px;
            }
            
            .form-group {
                margin-bottom: 16px;
            }
            
            .btn {
                padding: 14px 24px;
                font-size: 15px;
            }
        }
        
        @media (max-width: 480px) {
            .header h1 {
                font-size: 1.8em;
            }
            
            .header p {
                font-size: 0.95em;
            }
            
            .sidebar, .content {
                padding: 16px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸš€ Airflow DAG ìƒì„±ê¸°</h1>
            <p>ë¸Œë¼ìš°ì €ì—ì„œ ë°”ë¡œ ì‚¬ìš©í•˜ëŠ” DAG íŒŒì¼ ìƒì„±ê¸°</p>
        </div>
        
        <div class="main">
            <div class="sidebar">
                <h2 style="margin-bottom: 24px; font-size: 1.5em; color: #e4e4e7; font-weight: 600;">âš™ï¸ ì„¤ì •</h2>
                
                <div class="form-group">
                    <label for="filename">ğŸ“„ íŒŒì¼ëª…</label>
                    <input type="text" id="filename" placeholder="my_dag.py" value="my_dag.py">
                </div>
                
                <div class="form-group">
                    <label for="tags">ğŸ·ï¸ íƒœê·¸ (ì½¤ë§ˆë¡œ êµ¬ë¶„)</label>
                    <input type="text" id="tags" placeholder="tag1, tag2, tag3" value="auto-generated">
                </div>
                
                <div class="form-group">
                    <label for="description">ğŸ“ ì„¤ëª…</label>
                    <textarea id="description" placeholder="DAGì— ëŒ€í•œ ìƒì„¸í•œ ì„¤ëª…ì„ ì…ë ¥í•˜ì„¸ìš”">ìë™ ìƒì„±ëœ DAG</textarea>
                </div>
                
                <div class="form-group">
                    <label for="owner">ğŸ‘¤ ì†Œìœ ì</label>
                    <input type="text" id="owner" placeholder="í™ê¸¸ë™" value="í™ê¸¸ë™">
                </div>
                
                <div class="form-group">
                    <label for="email">ğŸ“§ ì´ë©”ì¼</label>
                    <input type="email" id="email" placeholder="admin@kt.com" value="admin@kt.com">
                </div>
                
                <div class="form-group">
                    <label for="schedule_type">â° ìŠ¤ì¼€ì¤„ íƒ€ì…</label>
                    <select id="schedule_type" onchange="toggleScheduleInput()">
                        <option value="preset">ë¯¸ë¦¬ ì„¤ì •ëœ ìŠ¤ì¼€ì¤„</option>
                        <option value="cron">Cron í‘œí˜„ì‹</option>
                        <option value="timedelta">ì‹œê°„ ê°„ê²©</option>
                        <option value="none">None (ìˆ˜ë™ ì‹¤í–‰)</option>
                    </select>
                </div>
                
                <div class="form-group" id="preset-schedule">
                    <label for="schedule_preset">â° ìŠ¤ì¼€ì¤„</label>
                    <select id="schedule_preset">
                        <option value="@daily">@daily (ë§¤ì¼)</option>
                        <option value="@hourly">@hourly (ë§¤ì‹œê°„)</option>
                        <option value="@weekly">@weekly (ë§¤ì£¼)</option>
                        <option value="@monthly">@monthly (ë§¤ì›”)</option>
                    </select>
                </div>
                
                <div class="form-group" id="cron-schedule" style="display: none;">
                    <label for="schedule_cron">â° Cron í‘œí˜„ì‹</label>
                    <input type="text" id="schedule_cron" placeholder="*/5 * * * *" value="*/5 * * * *" oninput="updateCronDescription()">
                    <small id="cron-description" style="color: #9ca3af; font-size: 12px; display: block; margin-top: 4px;">5ë¶„ë§ˆë‹¤ ì‹¤í–‰</small>
                </div>
                
                <div class="form-group" id="timedelta-schedule" style="display: none;">
                    <label for="schedule_timedelta">â° ì‹¤í–‰ ê°„ê²© (ë¶„)</label>
                    <input type="number" id="schedule_timedelta" placeholder="60" value="60" min="1">
                </div>
                
                <div class="form-group">
                    <label for="start_date">ğŸ“… ì‹œì‘ì¼</label>
                    <input type="date" id="start_date">
                </div>
                
                <div class="form-group">
                    <label for="end_date">ğŸ”š ì¢…ë£Œì¼ (ì„ íƒì‚¬í•­)</label>
                    <input type="date" id="end_date">
                </div>
                
                <div class="form-group">
                    <label for="retries">ğŸ”„ ì¬ì‹œë„ íšŸìˆ˜</label>
                    <input type="number" id="retries" placeholder="1" value="1" min="0" max="10">
                </div>
                
                <div class="form-group">
                    <label for="retry_delay">â³ ì¬ì‹œë„ ì§€ì—° ì‹œê°„ (ë¶„)</label>
                    <input type="number" id="retry_delay" placeholder="5" value="5" min="1">
                </div>
                
                <div class="form-group">
                    <label for="max_active_runs">ğŸ”¢ ìµœëŒ€ ë™ì‹œ ì‹¤í–‰ ìˆ˜</label>
                    <input type="number" id="max_active_runs" placeholder="1" value="1" min="1">
                </div>
                
                
                <button class="btn" onclick="generateDAG()">ğŸ”„ DAG ìƒì„±</button>
                <button class="btn" onclick="downloadFile()" id="downloadBtn" disabled>ğŸ’¾ íŒŒì¼ ë‹¤ìš´ë¡œë“œ</button>
                
                <div class="info">
                    <h3>ğŸ’¡ ì‚¬ìš©ë²•</h3>
                    <p>1. íŒŒì¼ëª… ì…ë ¥ (DAG ID ìë™ ìƒì„±)</p>
                    <p>2. ì†Œìœ ì ë° ì´ë©”ì¼ ì •ë³´ ì…ë ¥</p>
                    <p>3. ìŠ¤ì¼€ì¤„ íƒ€ì… ì„ íƒ ë° ì„¤ì •</p>
                    <p>4. ì¬ì‹œë„ ì˜µì…˜ ë° íƒœê·¸ ì„¤ì •</p>
                    <p>5. DAG ìƒì„± â†’ ë¯¸ë¦¬ë³´ê¸° í™•ì¸ â†’ ë‹¤ìš´ë¡œë“œ</p>
                </div>
                
                <div class="info">
                    <h3>ğŸ”§ ìƒì„±ë˜ëŠ” í…œí”Œë¦¿ (ì˜ˆì‹œ)</h3>
                    <p>â€¢ <strong>Task 1:</strong> ì„œë²„ ìƒíƒœ í™•ì¸</p>
                    <p>â€¢ <strong>Task 2:</strong> ì‹œìŠ¤í…œ ì •ë³´ í™•ì¸</p>
                    <p>â€¢ <strong>ì˜ì¡´ì„±:</strong> Task 1 â†’ Task 2</p>
                </div>
                
                <div class="info">
                    <h3>âš ï¸ ì‚¬ìš© ì „ í•„ìˆ˜ ì„¤ì • (ì˜ˆì‹œ)</h3>
                    <p>â€¢ Airflow Connection ì„¤ì •:</p>
                    <p>  - Connection ID: <code>ssh_default</code></p>
                    <p>  - SSH í˜¸ìŠ¤íŠ¸, ì‚¬ìš©ì, í‚¤ íŒŒì¼ ì„¤ì •</p>
                </div>
            </div>
            
            <div class="content">
                <h2 style="margin-bottom: 24px; font-size: 1.5em; color: #e4e4e7; font-weight: 600;">ğŸ“ DAG ì •ë³´ ë° ë¯¸ë¦¬ë³´ê¸°</h2>
                
                <div id="status"></div>
                
                <div id="preview" class="preview" style="display: none;"></div>
                
                <div id="info-panel">
                    <p>ì„¤ì •ì„ ì…ë ¥í•˜ê³  "DAG ìƒì„±" ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”.</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        const DAG_TEMPLATE = `
# =============================================================================
# DAG íŒŒì¼ëª…: {dag_id}
# ì‘ì„±ì: {owner}
# ì´ë©”ì¼: {email}
# ìƒì„±ì¼: {generated_date}
#
# DAG ì„¤ëª…:
# {description}
#
# ì‹¤í–‰ ìŠ¤ì¼€ì¤„: {schedule}
# ì¬ì‹œë„ íšŸìˆ˜: {retries}íšŒ
# ì¬ì‹œë„ ê°„ê²©: {retry_delay}ë¶„
# ìµœëŒ€ ë™ì‹œ ì‹¤í–‰: {max_active_runs}ê°œ
# =============================================================================

from airflow import DAG
from airflow.providers.ssh.operators.ssh import SSHOperator
from datetime import datetime, timedelta

# ==============================================================================
# DAG ê¸°ë³¸ ì„¤ì •
# ==============================================================================

# ê¸°ë³¸ ì¸ì ì„¤ì • - ëª¨ë“  íƒœìŠ¤í¬ì— ê³µí†µìœ¼ë¡œ ì ìš©
default_args = {
    'owner': '{owner}',
    'depends_on_past': False,
    'email': ['{email}'],
    'email_on_failure': True,
    'email_on_retry': False,
    'retries': {retries},
    'retry_delay': timedelta(minutes={retry_delay}),
    'start_date': datetime({start_year}, {start_month}, {start_day}),
}

# ==============================================================================
# DAG ì •ì˜
# ==============================================================================

# DAG ì¸ìŠ¤í„´ìŠ¤ ìƒì„±
dag = DAG(
    dag_id='{dag_id}',
    description='{description}',
    default_args=default_args,
    schedule_interval={schedule},
    start_date=datetime({start_year}, {start_month}, {start_day}),{end_date_line}
    catchup=False,
    max_active_runs={max_active_runs},
    tags={tags},
    doc_md=__doc__,
)

# ==============================================================================
# íƒœìŠ¤í¬ ì •ì˜
# ==============================================================================

# íƒœìŠ¤í¬ 1: ì„œë²„ ìƒíƒœ í™•ì¸
check_host = SSHOperator(
    task_id='check_host',
    ssh_conn_id='ssh_default',
    command='echo "Hello from localhost: $(hostname) at $(date)"',
    dag=dag,
)

# íƒœìŠ¤í¬ 2: ì‹œìŠ¤í…œ ì •ë³´ í™•ì¸
system_info = HttpOperator(
    task_id='system_info',
	method='POST',
	http_conn_id='http_default',
	headers={'Content-Type': 'application/json'},
    endpoint='http://localhost:5000/system_info',
	data=json.dumps({
        "action": "get_info"
    }),
    dag=dag,
)

# ==============================================================================
# íƒœìŠ¤í¬ ì˜ì¡´ì„± ì •ì˜
# ==============================================================================

# íƒœìŠ¤í¬ ì‹¤í–‰ ìˆœì„œ ì •ì˜
check_host >> system_info
`;

        let generatedCode = '';
        let generatedFilename = '';

        function toggleScheduleInput() {
            const scheduleType = document.getElementById('schedule_type').value;
            const presetDiv = document.getElementById('preset-schedule');
            const cronDiv = document.getElementById('cron-schedule');
            const timeDeltaDiv = document.getElementById('timedelta-schedule');
            
            // ëª¨ë“  ìŠ¤ì¼€ì¤„ ì…ë ¥ ìˆ¨ê¸°ê¸°
            presetDiv.style.display = 'none';
            cronDiv.style.display = 'none';
            timeDeltaDiv.style.display = 'none';
            
            // ì„ íƒëœ íƒ€ì…ì— ë”°ë¼ í‘œì‹œ
            switch(scheduleType) {
                case 'preset':
                    presetDiv.style.display = 'block';
                    break;
                case 'cron':
                    cronDiv.style.display = 'block';
                    break;
                case 'timedelta':
                    timeDeltaDiv.style.display = 'block';
                    break;
            }
        }

        function generateDAG() {
            // í¼ ë°ì´í„° ìˆ˜ì§‘
            const filename = document.getElementById('filename').value.trim();
            const owner = document.getElementById('owner').value.trim();
            const email = document.getElementById('email').value.trim();
            const description = document.getElementById('description').value.trim();
            const scheduleType = document.getElementById('schedule_type').value;
            const retries = document.getElementById('retries').value;
            const retryDelay = document.getElementById('retry_delay').value;
            const tags = document.getElementById('tags').value.trim();
            const maxActiveRuns = document.getElementById('max_active_runs').value;
            const startDate = document.getElementById('start_date').value;
            const endDate = document.getElementById('end_date').value;
            
            // ìœ íš¨ì„± ê²€ì‚¬
            if (!filename) {
                showStatus('error', 'íŒŒì¼ëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            if (!filename.endsWith('.py')) {
                showStatus('error', 'íŒŒì¼ëª…ì€ .py í™•ì¥ìë¡œ ëë‚˜ì•¼ í•©ë‹ˆë‹¤.');
                return;
            }
            
            if (!owner) {
                showStatus('error', 'ì†Œìœ ìë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            if (!email) {
                showStatus('error', 'ì´ë©”ì¼ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            // DAG ID ìƒì„± (íŒŒì¼ëª…ì—ì„œ .py ì œê±°)
            const dagId = filename.replace('.py', '');
            
            // ìŠ¤ì¼€ì¤„ ì²˜ë¦¬
            let schedule;
            switch(scheduleType) {
                case 'preset':
                    schedule = `'${document.getElementById('schedule_preset').value}'`;
                    break;
                case 'cron':
                    const cronValue = document.getElementById('schedule_cron').value.trim();
                    if (!cronValue) {
                        showStatus('error', 'Cron í‘œí˜„ì‹ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                        return;
                    }
                    schedule = `'${cronValue}'`;
                    break;
                case 'timedelta':
                    const minutes = document.getElementById('schedule_timedelta').value;
                    if (!minutes) {
                        showStatus('error', 'ì‹¤í–‰ ê°„ê²©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                        return;
                    }
                    schedule = `timedelta(minutes=${minutes})`;
                    break;
                case 'none':
                    schedule = 'None';
                    break;
            }
            
            // íƒœê·¸ ì²˜ë¦¬
            const tagsList = tags.split(',').map(tag => tag.trim()).filter(tag => tag);
            const tagsFormatted = JSON.stringify(tagsList);
            
            // ë‚ ì§œ ì²˜ë¦¬
            const startDateObj = new Date(startDate);
            const startYear = startDateObj.getFullYear();
            const startMonth = startDateObj.getMonth() + 1;
            const startDay = startDateObj.getDate();
            
            let endDateLine = '';
            if (endDate) {
                const endDateObj = new Date(endDate);
                const endYear = endDateObj.getFullYear();
                const endMonth = endDateObj.getMonth() + 1;
                const endDay = endDateObj.getDate();
                endDateLine = `\n    end_date=datetime(${endYear}, ${endMonth}, ${endDay}),`;
            }
            
            // í˜„ì¬ ë‚ ì§œ
            const now = new Date();
            const generatedDate = now.toISOString().split('T')[0];
            
            // ì½”ë“œ ìƒì„±
            generatedCode = DAG_TEMPLATE
                .replace(/{dag_id}/g, dagId)
                .replace(/{description}/g, description)
                .replace(/{owner}/g, owner)
                .replace(/{email}/g, email)
                .replace(/{generated_date}/g, generatedDate)
                .replace(/{schedule}/g, schedule)
                .replace(/{retries}/g, retries)
                .replace(/{retry_delay}/g, retryDelay)
                .replace(/{max_active_runs}/g, maxActiveRuns)
                .replace(/{tags}/g, tagsFormatted)
                .replace(/{start_year}/g, startYear)
                .replace(/{start_month}/g, startMonth)
                .replace(/{start_day}/g, startDay)
                .replace(/{end_date_line}/g, endDateLine);
            
            generatedFilename = filename;
            
            // UI ì—…ë°ì´íŠ¸ - DAG ìƒì„± í›„ì—ëŠ” ë¯¸ë¦¬ë³´ê¸°ë§Œ í‘œì‹œ
            document.getElementById('preview').textContent = generatedCode;
            document.getElementById('preview').style.display = 'block';
            document.getElementById('downloadBtn').disabled = false;
            
            // ì •ë³´ íŒ¨ë„ ìˆ¨ê¸°ê¸°
            document.getElementById('info-panel').style.display = 'none';
            
            showStatus('success', 'ğŸ‰ DAG íŒŒì¼ì´ ì„±ê³µì ìœ¼ë¡œ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤!');
        }
        
        // ê°„ë‹¨í•œ Python êµ¬ë¬¸ ê°•ì¡° í•¨ìˆ˜
        function highlightPython(code) {
            return code
                .replace(/^(#.*$)/gm, '<span style="color: #6a9955; font-style: italic;">$1</span>')
                .replace(/\b(from|import|def|class|if|else|elif|for|while|try|except|finally|with|as|return|yield|break|continue|pass|raise|lambda|and|or|not|in|is|True|False|None)\b/g, '<span style="color: #569cd6;">$1</span>')
                .replace(/\b(DAG|SSHOperator|BashOperator|PythonOperator|datetime|timedelta)\b/g, '<span style="color: #4ec9b0;">$1</span>')
                .replace(/(['"])(.*?)\1/g, '<span style="color: #ce9178;">$1$2$1</span>')
                .replace(/\b(\d+)\b/g, '<span style="color: #b5cea8;">$1</span>');
        }
        
        function downloadFile() {
            if (!generatedCode) {
                showStatus('error', 'ë¨¼ì € DAGë¥¼ ìƒì„±í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            const blob = new Blob([generatedCode], {type: 'text/plain;charset=utf-8'});
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = generatedFilename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
            
            showStatus('success', `ğŸ’¾ ${generatedFilename} íŒŒì¼ì´ ë‹¤ìš´ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤!`);
        }
        
        function showStatus(type, message) {
            const statusDiv = document.getElementById('status');
            statusDiv.className = `status ${type}`;
            statusDiv.textContent = message;
            
            // 3ì´ˆ í›„ ìƒíƒœ ë©”ì‹œì§€ ì œê±°
            setTimeout(() => {
                statusDiv.textContent = '';
                statusDiv.className = '';
            }, 3000);
        }
        
        // ì‹¤ì‹œê°„ ë¯¸ë¦¬ë³´ê¸° (ì˜µì…˜)
        document.getElementById('filename').addEventListener('input', updateInfo);
        document.getElementById('owner').addEventListener('input', updateInfo);
        document.getElementById('email').addEventListener('input', updateInfo);
        document.getElementById('description').addEventListener('input', updateInfo);
        
        function updateInfo() {
            const filename = document.getElementById('filename').value.trim();
            const owner = document.getElementById('owner').value.trim();
            const email = document.getElementById('email').value.trim();
            const dagId = filename.replace('.py', '');
            
            if (filename || owner || email) {
                document.getElementById('info-panel').innerHTML = `
                    <div class="info">
                        <h3>ğŸ“‹ í˜„ì¬ ì„¤ì •</h3>
                        <p><strong>íŒŒì¼ëª…:</strong> ${filename || 'ë¯¸ì…ë ¥'}</p>
                        <p><strong>DAG ID:</strong> ${dagId || 'ë¯¸ì…ë ¥'}</p>
                        <p><strong>ì†Œìœ ì:</strong> ${owner || 'ë¯¸ì…ë ¥'}</p>
                        <p><strong>ì´ë©”ì¼:</strong> ${email || 'ë¯¸ì…ë ¥'}</p>
                    </div>
                `;
            } else {
                document.getElementById('info-panel').innerHTML = `
                    <div class="info">
                        <h3>ğŸ“‹ í˜„ì¬ ì„¤ì •</h3>
                        <p>ì„¤ì •ì„ ì…ë ¥í•˜ê³  "DAG ìƒì„±" ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”.</p>
                    </div>
                `;
            }
        }
        
        // Cron í‘œí˜„ì‹ ì„¤ëª… ì—…ë°ì´íŠ¸ í•¨ìˆ˜
        function updateCronDescription() {
            const cronValue = document.getElementById('schedule_cron').value.trim();
            const cronDescription = document.getElementById('cron-description');
            
            if (!cronValue) {
                cronDescription.textContent = 'Cron í‘œí˜„ì‹ì„ ì…ë ¥í•˜ì„¸ìš”';
                return;
            }
            
            const parts = cronValue.split(' ');
            if (parts.length !== 5) {
                cronDescription.textContent = 'ì˜¬ë°”ë¥¸ Cron í˜•ì‹: ë¶„ ì‹œ ì¼ ì›” ìš”ì¼ (5ê°œ í•„ë“œ)';
                return;
            }
            
            const [minute, hour, day, month, dayOfWeek] = parts;
            
            // ì¼ë°˜ì ì¸ Cron íŒ¨í„´ í•´ì„
            const descriptions = {
                '0 0 * * *': 'ë§¤ì¼ ìì • (00:00)ì— ì‹¤í–‰',
                '0 6 * * *': 'ë§¤ì¼ ì˜¤ì „ 6ì‹œì— ì‹¤í–‰',
                '0 12 * * *': 'ë§¤ì¼ ì •ì˜¤ (12:00)ì— ì‹¤í–‰',
                '0 18 * * *': 'ë§¤ì¼ ì˜¤í›„ 6ì‹œì— ì‹¤í–‰',
                '0 0 * * 0': 'ë§¤ì£¼ ì¼ìš”ì¼ ìì •ì— ì‹¤í–‰',
                '0 0 * * 1': 'ë§¤ì£¼ ì›”ìš”ì¼ ìì •ì— ì‹¤í–‰',
                '0 0 1 * *': 'ë§¤ì›” 1ì¼ ìì •ì— ì‹¤í–‰',
                '0 0 1 1 *': 'ë§¤ë…„ 1ì›” 1ì¼ ìì •ì— ì‹¤í–‰',
                '*/5 * * * *': '5ë¶„ë§ˆë‹¤ ì‹¤í–‰',
                '*/10 * * * *': '10ë¶„ë§ˆë‹¤ ì‹¤í–‰',
                '*/15 * * * *': '15ë¶„ë§ˆë‹¤ ì‹¤í–‰',
                '*/30 * * * *': '30ë¶„ë§ˆë‹¤ ì‹¤í–‰',
                '0 */2 * * *': '2ì‹œê°„ë§ˆë‹¤ ì‹¤í–‰',
                '0 */4 * * *': '4ì‹œê°„ë§ˆë‹¤ ì‹¤í–‰',
                '0 */6 * * *': '6ì‹œê°„ë§ˆë‹¤ ì‹¤í–‰',
                '0 */12 * * *': '12ì‹œê°„ë§ˆë‹¤ ì‹¤í–‰',
                '0 9 * * 1-5': 'í‰ì¼ ì˜¤ì „ 9ì‹œì— ì‹¤í–‰',
                '0 17 * * 1-5': 'í‰ì¼ ì˜¤í›„ 5ì‹œì— ì‹¤í–‰',
                '0 0 * * 6,7': 'ì£¼ë§ ìì •ì— ì‹¤í–‰',
                '0 0 15 * *': 'ë§¤ì›” 15ì¼ ìì •ì— ì‹¤í–‰',
                '0 9-17 * * 1-5': 'í‰ì¼ ì˜¤ì „ 9ì‹œë¶€í„° ì˜¤í›„ 5ì‹œê¹Œì§€ ë§¤ì‹œê°„ ì‹¤í–‰'
            };
            
            if (descriptions[cronValue]) {
                cronDescription.textContent = descriptions[cronValue];
                return;
            }
            
            // ê¸°ë³¸ í•´ì„ ë¡œì§
            let desc = '';
            
            // ë¶„ í•´ì„
            if (minute === '*') {
                desc += 'ë§¤ë¶„ ';
            } else if (minute.includes('*/')) {
                const interval = minute.split('*/')[1];
                desc += `${interval}ë¶„ë§ˆë‹¤ `;
            } else {
                desc += `${minute}ë¶„ì— `;
            }
            
            // ì‹œê°„ í•´ì„
            if (hour === '*') {
                desc += 'ë§¤ì‹œê°„ ';
            } else if (hour.includes('*/')) {
                const interval = hour.split('*/')[1];
                desc += `${interval}ì‹œê°„ë§ˆë‹¤ `;
            } else {
                desc += `${hour}ì‹œì— `;
            }
            
            // ì¼ í•´ì„
            if (day === '*') {
                desc += 'ë§¤ì¼ ';
            } else if (day.includes('*/')) {
                const interval = day.split('*/')[1];
                desc += `${interval}ì¼ë§ˆë‹¤ `;
            } else {
                desc += `${day}ì¼ì— `;
            }
            
            // ì›” í•´ì„
            if (month === '*') {
                desc += 'ë§¤ì›” ';
            } else {
                const months = ['', '1ì›”', '2ì›”', '3ì›”', '4ì›”', '5ì›”', '6ì›”', '7ì›”', '8ì›”', '9ì›”', '10ì›”', '11ì›”', '12ì›”'];
                desc += `${months[parseInt(month)]}ì— `;
            }
            
            // ìš”ì¼ í•´ì„
            if (dayOfWeek !== '*') {
                const days = ['ì¼', 'ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† '];
                if (dayOfWeek === '1-5') {
                    desc += '(í‰ì¼) ';
                } else if (dayOfWeek === '6,7' || dayOfWeek === '0,6') {
                    desc += '(ì£¼ë§) ';
                } else if (dayOfWeek.includes(',')) {
                    const dayNumbers = dayOfWeek.split(',');
                    const dayNames = dayNumbers.map(d => days[parseInt(d)]);
                    desc += `(${dayNames.join(', ')}) `;
                } else {
                    desc += `(${days[parseInt(dayOfWeek)]}) `;
                }
            }
            
            cronDescription.textContent = desc.trim() + 'ì— ì‹¤í–‰';
        }
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸° ì„¤ì •
        function initializePage() {
            // ì‹œì‘ì¼ì„ ì˜¤ëŠ˜ ë‚ ì§œë¡œ ì„¤ì •
            const today = new Date();
            const todayString = today.toISOString().split('T')[0];
            document.getElementById('start_date').value = todayString;
            
            // ì´ˆê¸° ì •ë³´ ì—…ë°ì´íŠ¸
            updateInfo();
        }
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        initializePage();
    </script>
</body>
</html>